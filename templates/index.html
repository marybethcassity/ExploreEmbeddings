<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <script src="{{ url_for('static', filename='js/jquery-1.11.1.min.js') }}"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        .container {
            display: flex;
            justify-content: space-around; /* Adjust the layout as needed */
            align-items: center;
        }

        #graph, #frame-container {
            flex: 1; /* Allows each child to grow equally */
            max-width: 50%; /* Adjust the width as needed */
        }
        #frame-container img {
            max-width: 100%; /* Ensures the image fits within the container */
            height: auto; /* Keeps the image aspect ratio */
            float: right;
        }
    </style>
</head>
<body>
    <h1>Explore Pose Embeddings</h1>

    <form method='POST' enctype='multipart/form-data'>
        {{ uploadform.hidden_tag() }}
        {{ uploadform.csrf_token }}
        <div>
            {{ uploadform.folder.label }} {{ uploadform.folder }}
        </div>
        <div>
        {{ uploadform.upload }}
        </div>
    </form>

    <form method='POST' enctype='multipart/form-data'>
        {{ clusterform.hidden_tag() }}
        {{ clusterform.csrf_token }}
        <div>
            {{ clusterform.cluster }} 
        </div>
    </form>

    <div class="container">
        <div id="graph" style="width:100%;height:500px;"></div>
        <div id="frame-container" style="width:100%;height:100%;"></div>
    </div>
    
    <div id="plot-info"></div>

    <script type="text/javascript">
            var graph = {{graphJSON | safe}};
            Plotly.newPlot('graph', graph,{});

            var plotDiv = document.getElementById('graph');
        plotDiv.on('plotly_click', function(data) {
            var clickInfo = data.points.map(function(point) {
                return {
                    'x': point.x,
                    'y': point.y,
                    'z': point.z,
                    'frame': point.customdata[0],
                    'assignment': point.customdata[1]
                };
            });

            $.ajax({
                url: '/process_click_data',
                type: 'POST',
                data: JSON.stringify(clickInfo),
                contentType: 'application/json',
                success: function(response) {
                    console.log('Click data sent successfully:', response);

                    if (response.frame_data) {
                        // Create an image element and set its src attribute with the frame data
                        var frameContainer = document.getElementById('frame-container');
                        frameContainer.innerHTML = '';
                        var frameImage = document.createElement('img');
                        frameImage.src = 'data:image/jpeg;base64,' + response.frame_data;
                        frameImage.width = 3840/2; 
                        frameImage.height = 2160/2;
                        frameContainer.appendChild(frameImage);
                    } else {
                        console.error(response.error);
                    }
                },
                error: function(error) {
                    console.error('Error sending click data:', error);
                }
            });

            var infoDiv = document.getElementById('plot-info');
            infoDiv.innerHTML = '';
            <!-- 
            clickInfo.forEach(function(info) {
                var infoElement = document.createElement('p');
                infoElement.textContent = 'x: ' + info.x + ', y: ' + info.y + ', z: ' + info.z +
                                      ', frame: ' + info.frame + ', assignment: ' + info.assignment;
                infoDiv.appendChild(infoElement);
            }); 
            -->
        });
    </script>
</body>
</html>